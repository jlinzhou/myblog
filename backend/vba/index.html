<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>各种小脚本 | 一朝春诔</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="assets/img/favicon.ico">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <meta name="description" content="一朝春诔的学习笔记">
    <meta name="author" content="一朝春诔">
    <meta name="keywords" content="vuepress介绍，vuepress说明，一朝春诔">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.27faccf6.css" as="style"><link rel="preload" href="/assets/js/app.c66daf63.js" as="script"><link rel="preload" href="/assets/js/6.a4c4b5d6.js" as="script"><link rel="preload" href="/assets/js/2.1492d491.js" as="script"><link rel="preload" href="/assets/js/19.4c204b03.js" as="script"><link rel="preload" href="/assets/js/3.90399333.js" as="script"><link rel="prefetch" href="/assets/js/10.87145463.js"><link rel="prefetch" href="/assets/js/11.221fba97.js"><link rel="prefetch" href="/assets/js/12.6d618a9e.js"><link rel="prefetch" href="/assets/js/13.e9fd99e7.js"><link rel="prefetch" href="/assets/js/14.bcb642bb.js"><link rel="prefetch" href="/assets/js/15.fea81881.js"><link rel="prefetch" href="/assets/js/16.b16a866f.js"><link rel="prefetch" href="/assets/js/17.0bb43579.js"><link rel="prefetch" href="/assets/js/18.22ba0fd4.js"><link rel="prefetch" href="/assets/js/20.d55386db.js"><link rel="prefetch" href="/assets/js/21.16a539c6.js"><link rel="prefetch" href="/assets/js/22.b6e7568d.js"><link rel="prefetch" href="/assets/js/23.61371c15.js"><link rel="prefetch" href="/assets/js/24.7a61ce68.js"><link rel="prefetch" href="/assets/js/25.01681911.js"><link rel="prefetch" href="/assets/js/26.445269f0.js"><link rel="prefetch" href="/assets/js/27.3edf5618.js"><link rel="prefetch" href="/assets/js/28.4a7bb011.js"><link rel="prefetch" href="/assets/js/29.26603a5b.js"><link rel="prefetch" href="/assets/js/30.ce9ff2b6.js"><link rel="prefetch" href="/assets/js/31.8d12639f.js"><link rel="prefetch" href="/assets/js/32.9bab80b0.js"><link rel="prefetch" href="/assets/js/33.af97f621.js"><link rel="prefetch" href="/assets/js/34.36f688fd.js"><link rel="prefetch" href="/assets/js/35.90ec0130.js"><link rel="prefetch" href="/assets/js/36.4ce99e67.js"><link rel="prefetch" href="/assets/js/37.fe5fc88d.js"><link rel="prefetch" href="/assets/js/38.825cb81a.js"><link rel="prefetch" href="/assets/js/39.1687418c.js"><link rel="prefetch" href="/assets/js/4.af5f5709.js"><link rel="prefetch" href="/assets/js/40.90b4b446.js"><link rel="prefetch" href="/assets/js/41.d57845e5.js"><link rel="prefetch" href="/assets/js/42.3b7842f1.js"><link rel="prefetch" href="/assets/js/43.ef0e2a2a.js"><link rel="prefetch" href="/assets/js/44.061210b2.js"><link rel="prefetch" href="/assets/js/45.610cdab5.js"><link rel="prefetch" href="/assets/js/46.59ea5ec0.js"><link rel="prefetch" href="/assets/js/47.d3ae0c51.js"><link rel="prefetch" href="/assets/js/48.8746a4f0.js"><link rel="prefetch" href="/assets/js/49.22e0b8b6.js"><link rel="prefetch" href="/assets/js/5.509f5358.js"><link rel="prefetch" href="/assets/js/50.ff3498d8.js"><link rel="prefetch" href="/assets/js/7.be7c9864.js"><link rel="prefetch" href="/assets/js/8.e855ae57.js"><link rel="prefetch" href="/assets/js/9.a7df38a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.27faccf6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">一朝春诔</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/golang/" class="nav-link">
  golang
</a></li><li class="dropdown-item"><!----> <a href="/backend/python/" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/backend/cplus/" class="nav-link">
  c++
</a></li><li class="dropdown-item"><!----> <a href="/backend/lua/" class="nav-link">
  lua
</a></li><li class="dropdown-item"><!----> <a href="/backend/vba/" class="nav-link router-link-exact-active router-link-active">
  vba
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/database/mongodb/" class="nav-link">
  mongodb
</a></li><li class="dropdown-item"><!----> <a href="/database/redis/" class="nav-link">
  redis
</a></li><li class="dropdown-item"><!----> <a href="/database/etcd/" class="nav-link">
  etcd
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programming/algo/" class="nav-link">
  算法与数据结构
</a></li><li class="dropdown-item"><!----> <a href="/programming/pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opersystem/windows/" class="nav-link">
  windows
</a></li><li class="dropdown-item"><!----> <a href="/opersystem/linux/" class="nav-link">
  linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/tool/goland/" class="nav-link">
  goland
</a></li><li class="dropdown-item"><!----> <a href="/tool/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/tool/pycharm/" class="nav-link">
  pycharm
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/other/rabbitmq/" class="nav-link">
  rabbitmq
</a></li><li class="dropdown-item"><!----> <a href="/other/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/other/k8s/" class="nav-link">
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/other/workrecord/" class="nav-link">
  工作记录
</a></li><li class="dropdown-item"><!----> <a href="/other/interview/" class="nav-link">
  面试宝典
</a></li><li class="dropdown-item"><!----> <a href="/other/other/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jlinzhou" target="_self" rel="" class="nav-link external">
  Github
  <!----></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/golang/" class="nav-link">
  golang
</a></li><li class="dropdown-item"><!----> <a href="/backend/python/" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/backend/cplus/" class="nav-link">
  c++
</a></li><li class="dropdown-item"><!----> <a href="/backend/lua/" class="nav-link">
  lua
</a></li><li class="dropdown-item"><!----> <a href="/backend/vba/" class="nav-link router-link-exact-active router-link-active">
  vba
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/database/mongodb/" class="nav-link">
  mongodb
</a></li><li class="dropdown-item"><!----> <a href="/database/redis/" class="nav-link">
  redis
</a></li><li class="dropdown-item"><!----> <a href="/database/etcd/" class="nav-link">
  etcd
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programming/algo/" class="nav-link">
  算法与数据结构
</a></li><li class="dropdown-item"><!----> <a href="/programming/pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opersystem/windows/" class="nav-link">
  windows
</a></li><li class="dropdown-item"><!----> <a href="/opersystem/linux/" class="nav-link">
  linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><span class="title">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/tool/goland/" class="nav-link">
  goland
</a></li><li class="dropdown-item"><!----> <a href="/tool/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/tool/pycharm/" class="nav-link">
  pycharm
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/other/rabbitmq/" class="nav-link">
  rabbitmq
</a></li><li class="dropdown-item"><!----> <a href="/other/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/other/k8s/" class="nav-link">
  k8s
</a></li><li class="dropdown-item"><!----> <a href="/other/workrecord/" class="nav-link">
  工作记录
</a></li><li class="dropdown-item"><!----> <a href="/other/interview/" class="nav-link">
  面试宝典
</a></li><li class="dropdown-item"><!----> <a href="/other/other/" class="nav-link">
  其他
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jlinzhou" target="_self" rel="" class="nav-link external">
  Github
  <!----></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vba</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/backend/vba/" class="active sidebar-link">各种小脚本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/vba/#_1-日报报保监模板代码" class="sidebar-link">1.日报报保监模板代码</a></li><li class="sidebar-sub-header"><a href="/backend/vba/#_2-中介模板代码" class="sidebar-link">2.中介模板代码</a></li><li class="sidebar-sub-header"><a href="/backend/vba/#_3-批单重计提" class="sidebar-link">3.批单重计提</a></li><li class="sidebar-sub-header"><a href="/backend/vba/#_4-http获取行情" class="sidebar-link">4.http获取行情</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-日报报保监模板代码"><a href="#_1-日报报保监模板代码" class="header-anchor">#</a> 1.日报报保监模板代码</h2> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> 取值<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pth <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span>
    
    fn0 <span class="token operator">=</span> Dir<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> <span class="token string">&quot;*.xls*&quot;</span><span class="token punctuation">)</span> <span class="token comment">'取时间用</span>
    <span class="token keyword">Set</span> d <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary&quot;</span><span class="token punctuation">)</span> <span class="token comment">'存储数据时间的所在列</span>
    <span class="token keyword">Set</span> d2 <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary&quot;</span><span class="token punctuation">)</span> <span class="token comment">'存储 时间+险种+地区 的数据</span>
    <span class="token keyword">Set</span> d0 <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary&quot;</span><span class="token punctuation">)</span> <span class="token comment">'存储文件的时间</span>
    
    d<span class="token punctuation">(</span><span class="token string">&quot;今日&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span>
    d<span class="token punctuation">(</span><span class="token string">&quot;昨日&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;c&quot;</span>
    d<span class="token punctuation">(</span><span class="token string">&quot;18&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;d&quot;</span>
    d<span class="token punctuation">(</span><span class="token string">&quot;17&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;e&quot;</span>
    
    <span class="token comment">'根据每个表的b4单元格的日期判断数据时间</span>
    <span class="token keyword">Do</span> <span class="token keyword">While</span> fn0 <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">Set</span> wb0 <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> fn0<span class="token punctuation">)</span>
            rq <span class="token operator">=</span> Split<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">If</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>rq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>rq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span>
                <span class="token keyword">If</span> <span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>rq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">Then</span> <span class="token comment">''''''''''''''''''''''</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;今日&quot;</span>
                <span class="token keyword">Else</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;昨日&quot;</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">Else</span>
                <span class="token keyword">If</span> <span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>rq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">Then</span> <span class="token comment">''''''''''''''''''''''''</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;18&quot;</span>
                <span class="token keyword">Else</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;17&quot;</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        wb0<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
        
        fn0 <span class="token operator">=</span> Dir
    <span class="token keyword">Loop</span>
    
    <span class="token comment">'清空数据</span>
    <span class="token keyword">With</span> ThisWorkbook
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token number">16</span>
            <span class="token keyword">For</span> <span class="token keyword">Each</span> rn <span class="token keyword">In</span> [<span class="token punctuation">{</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">}</span>]
                <span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;交强险&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span>rn <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;**&quot;</span>
                <span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;商业险&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span>rn <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;**&quot;</span>
                <span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;整体&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span>rn <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;**&quot;</span>
            <span class="token keyword">Next</span>
        <span class="token keyword">Next</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    <span class="token comment">'存储 时间+险种+地区 的数据,并根据 时间+险种+地区 给 交强险 商业险的工作簿表格赋值</span>
    fn <span class="token operator">=</span> Dir<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> <span class="token string">&quot;*.xls*&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> arr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xztype<span class="token operator">$</span><span class="token punctuation">,</span> diqu<span class="token operator">$</span>
    <span class="token keyword">Do</span> <span class="token keyword">While</span> fn <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">Set</span> wb <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> fn<span class="token punctuation">)</span>
        riqi <span class="token operator">=</span> d0<span class="token punctuation">(</span>wb<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
        na <span class="token operator">=</span> d<span class="token punctuation">(</span>riqi<span class="token punctuation">)</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">To</span> wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UsedRange<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count <span class="token operator">-</span> <span class="token number">1</span>
            <span class="token keyword">If</span> wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;10030101-交强险&quot;</span> <span class="token keyword">Then</span>
                xztype <span class="token operator">=</span> <span class="token string">&quot;交强险&quot;</span>
            <span class="token keyword">Else</span>
                xztype <span class="token operator">=</span> <span class="token string">&quot;商业险&quot;</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
            diqu <span class="token operator">=</span> Replace<span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;分公司&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
            d2<span class="token punctuation">(</span>riqi <span class="token operator">&amp;</span> xztype <span class="token operator">&amp;</span> diqu<span class="token punctuation">)</span> <span class="token operator">=</span> wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span>
        <span class="token keyword">Next</span>
        
        <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;交强险&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">To</span> <span class="token number">16</span>
                <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d2<span class="token punctuation">(</span>riqi <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">Next</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> d2<span class="token punctuation">(</span>riqi <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;河南营业本部&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> d2<span class="token punctuation">(</span>riqi <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;郑州&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
        
        <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;商业险&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">To</span> <span class="token number">16</span>
                <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d2<span class="token punctuation">(</span>riqi <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">Next</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> d2<span class="token punctuation">(</span>riqi <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;河南营业本部&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> d2<span class="token punctuation">(</span>riqi <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;郑州&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
        
        wb<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
        fn <span class="token operator">=</span> Dir
    <span class="token keyword">Loop</span>
    <span class="token comment">'给整体工作簿复制</span>
    <span class="token keyword">With</span> ThisWorkbook
        <span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;交强险&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b2:e16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Copy
        <span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;整体&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b2:e16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PasteSpecial Paste<span class="token punctuation">:</span><span class="token operator">=</span>xlPasteAll
        <span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;商业险&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b2:e16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Copy
        <span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;整体&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b2:e16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PasteSpecial Paste<span class="token punctuation">:</span><span class="token operator">=</span>xlPasteValues<span class="token punctuation">,</span> Operation<span class="token punctuation">:</span><span class="token operator">=</span>xlPasteSpecialOperationAdd
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token comment">'生成新的车险业务签单数据日报表</span>
    <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;车险业务签单数据日报表&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b6:b24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b6:b24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;c6:c24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d6:d24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d6:d24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;g6:g24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e6:e24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;h6:h24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;f6:f24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j6:j24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;g6:g24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;m6:m24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;h6:h24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;n6:n24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;i6:i24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;p6:p24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j6:j24&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;s6:s24&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    <span class="token comment">'把&quot;#N/A&quot; 替换为&quot;-&quot;</span>
    ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;车险业务签单数据日报表&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Replace What<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;#N/A&quot;</span><span class="token punctuation">,</span> Replacement<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;-&quot;</span>
    
    <span class="token comment">'生成车险业务签单数据日报表,并保存到当前目录下</span>
    <span class="token keyword">Set</span> newbk <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Add
    ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;车险业务签单数据日报表&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Copy
    newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a1:j25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PasteSpecial Paste<span class="token punctuation">:</span><span class="token operator">=</span>xlPasteAll
    newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Replace What<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;日期：&quot;</span><span class="token punctuation">,</span> Replacement<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;日期：&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>Format<span class="token punctuation">(</span><span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;mm.dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;车险业务签单数据日报表&quot;</span>
    
    <span class="token keyword">If</span> Dir<span class="token punctuation">(</span>ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;车险业务签单数据日报表.xlsx&quot;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">Then</span>
        Kill <span class="token punctuation">(</span>ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;车险业务签单数据日报表.xlsx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    
    newbk<span class="token punctuation">.</span>SaveAs ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;车险业务签单数据日报表.xlsx&quot;</span>
    newbk<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
    MsgBox <span class="token string">&quot;成功在&quot;</span> <span class="token operator">&amp;</span> ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;    目录下生成&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;车险业务签单数据日报表.xlsx&quot;</span>
    
    <span class="token comment">'释放内存</span>
    <span class="token keyword">Set</span> d <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Set</span> d2 <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Set</span> d0 <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><h2 id="_2-中介模板代码"><a href="#_2-中介模板代码" class="header-anchor">#</a> 2.中介模板代码</h2> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Sub</span> 中介机构<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">'所有中介机构</span>
    jigou <span class="token operator">=</span> [<span class="token punctuation">{</span><span class="token string">&quot;百特&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;美联盛航&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;松泰&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;华诚&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;永丰&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;融元&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;金诺&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;颖海&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;升铭&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;安吉好途邦&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;宏安&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;华凯&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;广大&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;亚钰&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;国福家庭&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;安诚保险&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;华安&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;天时&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;瑞丰&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;浩安&quot;</span><span class="token punctuation">}</span>]
    
    <span class="token keyword">Set</span> d <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary&quot;</span><span class="token punctuation">)</span> <span class="token comment">'存储保单费</span>
    <span class="token keyword">Set</span> d0 <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary &quot;</span><span class="token punctuation">)</span> <span class="token comment">'存储文件的时间&quot;</span>
    pth1 <span class="token operator">=</span> <span class="token string">&quot;C:\Documents and Settings\Administrator\桌面\新建文件夹 (2)\中介\&quot;</span> <span class="token comment">''''''''''''''</span>
    
    fn0 <span class="token operator">=</span> Dir<span class="token punctuation">(</span>pth1 <span class="token operator">&amp;</span> <span class="token string">&quot;*.xls*&quot;</span><span class="token punctuation">)</span>
    
    
   <span class="token comment">'根据每个表的b4单元格的日期判断数据时间</span>
    <span class="token keyword">Do</span> <span class="token keyword">While</span> fn0 <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">Set</span> wb0 <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>pth1 <span class="token operator">&amp;</span> fn0<span class="token punctuation">)</span>
        <span class="token comment">'If wb0.Name &lt;&gt; &quot;代理机构车险业务签单保费周报表.xlsx&quot; Then</span>
            riqi <span class="token operator">=</span> Split<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">If</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>riqi<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>riqi<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">6</span> <span class="token keyword">Then</span>
                <span class="token keyword">If</span> <span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>riqi<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">6</span> <span class="token keyword">Then</span> <span class="token comment">'''''''''''''''''''''</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;当周&quot;</span>
                    thispn <span class="token operator">=</span> wb0<span class="token punctuation">.</span>Name <span class="token comment">'当周文件名</span>
                <span class="token keyword">Else</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;上周&quot;</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">Else</span>
                <span class="token keyword">If</span> <span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token keyword">CDate</span><span class="token punctuation">(</span>Mid<span class="token punctuation">(</span>riqi<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">6</span> <span class="token keyword">Then</span> <span class="token comment">'''''''''''''''''''''''</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;全年累计保费&quot;</span>
                <span class="token keyword">Else</span>
                    d0<span class="token punctuation">(</span>wb0<span class="token punctuation">.</span>Name<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;上年累计保费&quot;</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token comment">'End If</span>
        wb0<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
        fn0 <span class="token operator">=</span> Dir
    <span class="token keyword">Loop</span>
    
    
    fn1 <span class="token operator">=</span> Dir<span class="token punctuation">(</span>pth1 <span class="token operator">&amp;</span> thispn<span class="token punctuation">)</span>
    <span class="token keyword">Set</span> wb1 <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>pth1 <span class="token operator">&amp;</span> fn1<span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> arr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token operator">%</span>
    <span class="token keyword">ReDim</span> arr<span class="token punctuation">(</span>UBound<span class="token punctuation">(</span>jigou<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">'对当周签单保费进行统计,便于后面排序</span>
    <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">To</span> wb1<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UsedRange<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count
        <span class="token keyword">With</span> wb1<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            
            <span class="token keyword">For</span> <span class="token keyword">Each</span> jg <span class="token keyword">In</span> jigou
                <span class="token keyword">If</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token keyword">Like</span> <span class="token string">&quot;*&quot;</span> <span class="token operator">&amp;</span> jg <span class="token operator">&amp;</span> <span class="token string">&quot;*&quot;</span> <span class="token keyword">Then</span>
                    <span class="token keyword">If</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;10030101-交强险&quot;</span> <span class="token keyword">Then</span>
                        d<span class="token punctuation">(</span><span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> d<span class="token punctuation">(</span><span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span>
                    <span class="token keyword">Else</span>
                        d<span class="token punctuation">(</span><span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> d<span class="token punctuation">(</span><span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span>
                    <span class="token keyword">End</span> <span class="token keyword">If</span>
                    
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">Next</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token keyword">Next</span>


    wb1<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
    
    t <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">For</span> <span class="token keyword">Each</span> jg <span class="token keyword">In</span> jigou
        d<span class="token punctuation">(</span><span class="token string">&quot;总和&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span> <span class="token operator">+</span> d<span class="token punctuation">(</span><span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span>
        arr<span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token string">&quot;总和&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span>
        t <span class="token operator">=</span> t <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">Next</span>
    t <span class="token operator">=</span> t <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token comment">'用冒泡法对保费从小到大排列</span>
    <span class="token keyword">For</span> n <span class="token operator">=</span> t <span class="token keyword">To</span> <span class="token number">2</span> <span class="token keyword">Step</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> t
            <span class="token keyword">If</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                s <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                arr<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> arr<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                arr<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> s
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
    <span class="token keyword">Next</span>
    <span class="token comment">'sheet1表格的数据全部清空，防止混淆历史数据</span>
    <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">6</span> <span class="token keyword">To</span> <span class="token number">10</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;k&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;m&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>

            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;u&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;w&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;*#*&quot;</span>
        <span class="token keyword">Next</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    <span class="token comment">'将排名前五的机构名称和当周签单保费填入</span>
    <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">5</span>
        <span class="token keyword">For</span> <span class="token keyword">Each</span> jg <span class="token keyword">In</span> jigou
            <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">If</span> d<span class="token punctuation">(</span><span class="token string">&quot;总和&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span> <span class="token operator">=</span> arr<span class="token punctuation">(</span>t <span class="token operator">-</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                    <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> jg
                    <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token string">&quot;总和&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">End</span> <span class="token keyword">With</span>
        <span class="token keyword">Next</span>
    <span class="token keyword">Next</span>




    <span class="token comment">'存储 时间+险种+机构 的数据</span>
    fn2 <span class="token operator">=</span> Dir<span class="token punctuation">(</span>pth1 <span class="token operator">&amp;</span> <span class="token string">&quot;*.xls*&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">Do</span> <span class="token keyword">While</span> fn2 <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span>
         <span class="token keyword">Set</span> wb2 <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>pth1 <span class="token operator">&amp;</span> fn2<span class="token punctuation">)</span>
         na <span class="token operator">=</span> d0<span class="token punctuation">(</span>wb2<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
         <span class="token keyword">With</span> wb2<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">For</span> <span class="token keyword">Each</span> jg <span class="token keyword">In</span> jigou
                <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">To</span> <span class="token punctuation">.</span>UsedRange<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count
                    <span class="token keyword">If</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token keyword">Like</span> <span class="token string">&quot;*&quot;</span> <span class="token operator">&amp;</span> jg <span class="token operator">&amp;</span> <span class="token string">&quot;*&quot;</span> <span class="token keyword">Then</span>
                        <span class="token keyword">If</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;10030101-交强险&quot;</span> <span class="token keyword">Then</span>
                            d<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> d<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span>
                        <span class="token keyword">Else</span>
                            d<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> d<span class="token punctuation">(</span>na <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> jg<span class="token punctuation">)</span>
                        <span class="token keyword">End</span> <span class="token keyword">If</span>
                    <span class="token keyword">End</span> <span class="token keyword">If</span>
                <span class="token keyword">Next</span>
            <span class="token keyword">Next</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
        wb2<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
        fn2 <span class="token operator">=</span> Dir
    <span class="token keyword">Loop</span>

    <span class="token comment">'根据 时间+险种+机构 给工作簿表格赋值</span>
   <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">6</span> <span class="token keyword">To</span> <span class="token number">10</span>
        <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;k&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;k5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;p5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;交强险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;r&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;r5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;s5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;w&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;w5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;x5&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;商业险&quot;</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">End</span> <span class="token keyword">With</span>
   <span class="token keyword">Next</span>
    <span class="token comment">'生成新的工作簿</span>
    <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a6:a10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a6:a10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d6:d10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b6:b10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e6:e10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d6:d10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;f6:f10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;f6:f10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;g6:g10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;g6:g10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;h6:h10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;i6:i10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;i6:i10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j6:j10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j6:j10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;l6:l10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;k6:k10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;n6:n10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;l6:l10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o6:o10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;m6:m10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;q6:q10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;n6:n10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;r6:r10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o6:o10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;t6:t10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;p6:p10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;v6:v10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;q6:q10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;w6:w10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;r6:r10&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;y6:y10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    <span class="token comment">'替换</span>
    ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Replace What<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;#DIV/0!&quot;</span><span class="token punctuation">,</span> Replacement<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;-&quot;</span>
    ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Replace What<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;*#*&quot;</span><span class="token punctuation">,</span> Replacement<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;-&quot;</span>
    <span class="token comment">'代理机构车险业务签单保费周报表,并保存到当前目录下</span>
    <span class="token keyword">Set</span> newbk <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Add
    ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Copy
    newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>PasteSpecial Paste<span class="token punctuation">:</span><span class="token operator">=</span>xlPasteAll
    newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;代理机构车险业务签单保费周报表&quot;</span>

    <span class="token keyword">If</span> Dir<span class="token punctuation">(</span>ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;代理机构车险业务签单保费周报表.xlsx&quot;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">Then</span>
        Kill <span class="token punctuation">(</span>ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;代理机构车险业务签单保费周报表.xlsx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>

    newbk<span class="token punctuation">.</span>SaveAs ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;代理机构车险业务签单保费周报表.xlsx&quot;</span>
    newbk<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
    <span class="token keyword">Set</span> d <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Set</span> d2 <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    MsgBox <span class="token string">&quot;成功在&quot;</span> <span class="token operator">&amp;</span> ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;    目录下生成&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;代理机构车险业务签单保费周报表.xlsx&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div><h2 id="_3-批单重计提"><a href="#_3-批单重计提" class="header-anchor">#</a> 3.批单重计提</h2> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> CommandButton1_Click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">Dim</span> mulu1<span class="token operator">$</span><span class="token punctuation">,</span> pidan<span class="token operator">$</span>
    
    <span class="token keyword">Set</span> d <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary&quot;</span><span class="token punctuation">)</span> <span class="token comment">'创建字典，存储 险种+保单号 的签单保费，用来查找批单的原始保费</span>
    
    <span class="token keyword">Dim</span> starttime <span class="token keyword">As</span> <span class="token keyword">Double</span>
    starttime <span class="token operator">=</span> Timer
    mulu1 <span class="token operator">=</span> TextBox1<span class="token punctuation">.</span>Value

    pidan <span class="token operator">=</span> TextBox3<span class="token punctuation">.</span>Value

   <span class="token keyword">If</span> mulu1 <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">Then</span>
        MsgBox <span class="token string">&quot;目录未设置&quot;</span>
   <span class="token keyword">End</span> <span class="token keyword">If</span>
   <span class="token keyword">If</span> pidan <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">Then</span>
        MsgBox <span class="token string">&quot;批单文件名未设置&quot;</span>
   <span class="token keyword">End</span> <span class="token keyword">If</span>

   <span class="token keyword">If</span> mulu1 <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">Or</span> pidan <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">Then</span>
        <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
   <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token comment">'忽略错误继续执行VBA代码</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
    <span class="token comment">'存储所有核保日期的 险种+保单号 的签单保费</span>
    pth <span class="token operator">=</span> mulu1 <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span>
    fn <span class="token operator">=</span> Dir<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> <span class="token string">&quot;*.xls&quot;</span><span class="token punctuation">)</span>
    k <span class="token operator">=</span> <span class="token number">1</span>
    Application<span class="token punctuation">.</span>DisplayAlerts <span class="token operator">=</span> <span class="token boolean">False</span>
    Application<span class="token punctuation">.</span>ScreenUpdating <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">Do</span> <span class="token keyword">While</span> fn <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">Set</span> wb <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> fn<span class="token punctuation">)</span>
        <span class="token keyword">If</span> wb<span class="token punctuation">.</span>Name <span class="token operator">&lt;</span><span class="token operator">&gt;</span> pidan <span class="token keyword">Then</span>
        rownum <span class="token operator">=</span> wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UsedRange<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count
        <span class="token keyword">With</span> wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">For</span> t <span class="token operator">=</span> <span class="token number">4</span> <span class="token keyword">To</span> <span class="token punctuation">(</span>rownum <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">)</span>
                d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> t<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;l&quot;</span> <span class="token operator">&amp;</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;af&quot;</span> <span class="token operator">&amp;</span> t<span class="token punctuation">)</span>
            <span class="token keyword">Next</span>

        <span class="token keyword">End</span> <span class="token keyword">With</span>
        k <span class="token operator">=</span> k <span class="token operator">+</span> rownum <span class="token operator">-</span> <span class="token number">16</span>
        <span class="token keyword">End</span> <span class="token keyword">If</span>
        wb<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
        fn <span class="token operator">=</span> Dir
    <span class="token keyword">Loop</span>


    fn2 <span class="token operator">=</span> Dir<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> pidan<span class="token punctuation">)</span>


    <span class="token keyword">Set</span> wb2 <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>pth <span class="token operator">&amp;</span> fn2<span class="token punctuation">)</span>

    <span class="token comment">'新建一个工作簿用来保存批单的重计提</span>
    <span class="token keyword">Set</span> newbk <span class="token operator">=</span> Workbooks<span class="token punctuation">.</span>Add
    
    wb2_rownum <span class="token operator">=</span> wb2<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UsedRange<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span>Count
    
    ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>Copy
    newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Cells<span class="token punctuation">.</span>PasteSpecial Paste<span class="token punctuation">:</span><span class="token operator">=</span>xlPasteAll <span class="token comment">'把sheet2中的所有内容粘贴到新工作簿中,并且粘贴的格式不变</span>
    
    <span class="token comment">'把批单的的数据复制到模版中</span>
    <span class="token keyword">With</span> wb2<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;c4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;e&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;k4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;f3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;f&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;l4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;l&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;g3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;g&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;i4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;j&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;h3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;i&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;w4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;j&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;t4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;k3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;l&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;y4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;m3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;m&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ac4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ac&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;n3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;n&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ai4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ai&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;p3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;p&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;au4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;au&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;q3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;q&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;av4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;av&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;r3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ao4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ao&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;s3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;s&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;am4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;am&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;aq4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aq&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;v3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ax4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ax&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;x3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ay4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ay&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;z3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;z&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bc4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bc&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ab3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ab&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;af4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;af&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bt3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bt&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    <span class="token comment">'利用公式进行重计提</span>
    <span class="token keyword">With</span> newbk<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">3</span> <span class="token keyword">To</span> wb2_rownum
            <span class="token keyword">If</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                 <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bu&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">'查找批单的原始保费</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=P&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+Q&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+R&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+S&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+T&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+U&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ad&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=O&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+X&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+Z&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+AB&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;af&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=AG&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+AH&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+AI&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+AJ&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ag&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=IF(BF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=0,0,IF(D&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=&quot;&quot;交强险&quot;&quot;,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*4%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;/(IF(BF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=P&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*1.06,1.06,1.03)),IF(J&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=&quot;&quot;旧车&quot;&quot;,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*22%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;/(IF(BF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=P&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*1.06,1.06,1.03)),(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*27%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;/(IF(BF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=P&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*1.06,1.06,1.03)))))&quot;</span>

             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ah&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=IF(BG&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=0,0,IF(D&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=&quot;&quot;交强险&quot;&quot;,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BG&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*4%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;,IF(J&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=&quot;&quot;旧车&quot;&quot;,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BG&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*22%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BG&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*27%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;)))&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ai&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BH&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*0%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;aj&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=IF(BI&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=0,0,IF(D&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=&quot;&quot;交强险&quot;&quot;,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BI&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*4%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;/1.06,IF(J&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;=&quot;&quot;旧车&quot;&quot;,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BI&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*22%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;/1.06,(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BI&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*27%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;/1.06)))&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;as&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=(BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*BR&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*0%)/BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;au&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=AO&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+AQ&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+AS&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+AF&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;aw&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=BV&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ax&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=AW&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*AD&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;ay&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=AW&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*AU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;az&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=AY&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;-AX&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bb&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;09-自律原因&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bf&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=P&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*1.06&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bg&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=Q&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bh&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=R&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bi&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=S&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;*1.06&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;br&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=AB&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
             <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bv&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;=BT&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;+BU&quot;</span> <span class="token operator">&amp;</span> i <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">Next</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o&quot;</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;au&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Style <span class="token operator">=</span> <span class="token string">&quot;百分比&quot;</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;o&quot;</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;au&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>NumberFormatLocal <span class="token operator">=</span> <span class="token string">&quot;0.00%&quot;</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;aw&quot;</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;az&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>NumberFormatLocal <span class="token operator">=</span> <span class="token string">&quot;0.00&quot;</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bf&quot;</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;br&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>Style <span class="token operator">=</span> <span class="token string">&quot;百分比&quot;</span>
        <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;bf&quot;</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;br&quot;</span> <span class="token operator">&amp;</span> wb2_rownum<span class="token punctuation">)</span><span class="token punctuation">.</span>NumberFormatLocal <span class="token operator">=</span> <span class="token string">&quot;0.00%&quot;</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    
    <span class="token keyword">If</span> Dir<span class="token punctuation">(</span>mulu1 <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;车险业务费用重计提模板（&quot;</span> <span class="token operator">&amp;</span> Mid<span class="token punctuation">(</span><span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;）.xlsx&quot;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">Then</span>
        Kill <span class="token punctuation">(</span>mulu1 <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;车险业务费用重计提模板（&quot;</span> <span class="token operator">&amp;</span> Mid<span class="token punctuation">(</span><span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;）.xlsx&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    
    newbk<span class="token punctuation">.</span>SaveAs mulu1 <span class="token operator">&amp;</span> <span class="token string">&quot;\&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;车险业务费用重计提模板（&quot;</span> <span class="token operator">&amp;</span> Mid<span class="token punctuation">(</span><span class="token keyword">Date</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;）.xlsx&quot;</span>
    
    wb2<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
    newbk<span class="token punctuation">.</span>Close <span class="token boolean">True</span>
    Application<span class="token punctuation">.</span>DisplayAlerts <span class="token operator">=</span> <span class="token boolean">True</span>
    Application<span class="token punctuation">.</span>ScreenUpdating <span class="token operator">=</span> <span class="token boolean">True</span>
    UserForm1<span class="token punctuation">.</span>Hide
    MsgBox <span class="token string">&quot;重计提成功!&quot;</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;此次重计提耗时:&quot;</span> <span class="token operator">&amp;</span> Round<span class="token punctuation">(</span><span class="token punctuation">(</span>Timer <span class="token operator">-</span> starttime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;秒&quot;</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;文件目录为:&quot;</span> <span class="token operator">&amp;</span> mulu1<span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">&quot;提示&quot;</span>
    <span class="token keyword">Set</span> d <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

</code></pre></div><p>注释:日报报保监模板表格记录的是河南省各市的分机构签单保费的日报表。
该报表说明:首先是查看河南省各市的分机构的收益情况，然后和昨日的环比，就是看看保费是否有增或减少以及那个波动比率，如果波动比较大，可能这个分机构员工懈怠，这个地区被同行业的挤兑情况，然后今年1月1号到今天这个日期与去年一月一号到去年的这个日期的保费的同比，就是查看总体的保费的收益情况。
中介模板记录的是河南省各个代理机构代理太平财险的保费收益周报表。
该报表说明:指标有今日和昨日的环比，保费和全省的保费规模的之比，今日和昨日的环比就是看这个代理机构的发展趋势，占全省保费的比率就是看这个代理机构的规模大小，这两个参数就可以很好的了解到各个代理机构，有利于发掘良好的合作伙伴公司。
还有个批单重计提，就是如果前台的录单人员把保单的信息录入错误的话，就会产生个前后的保费差额，这个就是看前台人员的工作认真情况。</p> <h2 id="_4-http获取行情"><a href="#_4-http获取行情" class="header-anchor">#</a> 4.http获取行情</h2> <div class="language-vb extra-class"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Workbook_BeforeClose<span class="token punctuation">(</span>Cancel <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>
    <span class="token comment">'Application.OnTime RunWhen, &quot;refresh&quot;, , schedule:=False</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">Private</span> <span class="token keyword">Sub</span> Workbook_Open<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">Call</span> refresh
<span class="token keyword">End</span> <span class="token keyword">Sub</span>






<span class="token keyword">Public</span> CtronlReFresh <span class="token keyword">As</span> <span class="token keyword">Integer</span>

<span class="token keyword">Sub</span> refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
    
    RunWhen <span class="token operator">=</span> Now <span class="token operator">+</span> TimeValue<span class="token punctuation">(</span><span class="token string">&quot;00:00:10&quot;</span><span class="token punctuation">)</span> <span class="token comment">'Ê±¼ä¼ä¸ô</span>
    <span class="token comment">'ThisWorkbook.Save</span>
    Application<span class="token punctuation">.</span>OnTime RunWhen<span class="token punctuation">,</span> <span class="token string">&quot;refresh&quot;</span> <span class="token comment">'¶¨Ê±Æô¶¯³ÌÐò</span>
    <span class="token keyword">If</span> CtronlReFresh <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">Then</span>
        <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    
    
    <span class="token keyword">Dim</span> LastPrice<span class="token operator">$</span><span class="token punctuation">,</span> PreSettlementPrice<span class="token operator">$</span><span class="token punctuation">,</span> GetParams<span class="token operator">$</span><span class="token punctuation">,</span> InstrumentIdNum<span class="token operator">&amp;</span>
    LastPrice <span class="token operator">=</span> <span class="token string">&quot;lastPrice&quot;</span>
    PreSettlementPrice <span class="token operator">=</span> <span class="token string">&quot;preSettlementPrice&quot;</span>
    <span class="token comment">'Set SetingMap = CreateObject(&quot;scripting.dictionary&quot;)</span>
    <span class="token keyword">Set</span> InstrumentIdMap <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">Set</span> InstrumentInfoMap <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;scripting.dictionary&quot;</span><span class="token punctuation">)</span>
    GetParams <span class="token operator">=</span> <span class="token string">&quot;instrumentId=&quot;</span>
    InstrumentIdNum <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">Dim</span> strRespText<span class="token operator">$</span><span class="token punctuation">,</span> tt<span class="token operator">$</span><span class="token punctuation">,</span> i<span class="token operator">&amp;</span><span class="token punctuation">,</span> DW<span class="token operator">$</span>
    <span class="token keyword">Dim</span> URL
    <span class="token comment">'192.168.18.141:9568</span>
    <span class="token comment">'192.168.13.85:9090</span>
    <span class="token comment">'192.168.13.85:9568</span>
    <span class="token comment">'11</span>
    <span class="token comment">'http://km.sycapital.com.cn:19568</span>
    <span class="token comment">'http://km.sycapital.com.cn:19568/getmarket?instrumentId=CME.ES2003</span>
    URL <span class="token operator">=</span> <span class="token string">&quot;http://km.sycapital.com.cn:19568/getmarket?&quot;</span>
    <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token number">100</span>
            
            <span class="token keyword">If</span> <span class="token keyword">Not</span> IsEmpty<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                InstrumentIdNum <span class="token operator">=</span> InstrumentIdNum <span class="token operator">+</span> <span class="token number">1</span>
                <span class="token comment">'SetingMap(.Range(&quot;a&quot; &amp; i) &amp; LastPrice) = .Range(&quot;b&quot; &amp; i)</span>
                <span class="token comment">'SetingMap(.Range(&quot;a&quot; &amp; i) &amp; PreSettlementPrice) = .Range(&quot;c&quot; &amp; i)</span>
                
                
                InstrumentInfoMap<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">&amp;</span> LastPrice<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
                InstrumentInfoMap<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">&amp;</span> PreSettlementPrice<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
                InstrumentIdMap<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span>
            <span class="token keyword">Else</span>
                <span class="token keyword">If</span> i <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token keyword">Then</span>
                    MsgBox <span class="token string">&quot;¾¯¸æ!Ã»ÓÐÉèÖÃ²ÎÊý!!!&quot;</span>
                    <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
                <span class="token keyword">End</span> <span class="token keyword">If</span>
                
                <span class="token keyword">Exit</span> <span class="token keyword">For</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span>
    <span class="token keyword">End</span> <span class="token keyword">With</span>
    
    <span class="token keyword">For</span> <span class="token keyword">Each</span> element <span class="token keyword">In</span> InstrumentIdMap<span class="token punctuation">.</span>Keys
        <span class="token keyword">If</span> GetParams <span class="token operator">=</span> <span class="token string">&quot;instrumentId=&quot;</span> <span class="token keyword">Then</span>
                GetParams <span class="token operator">=</span> GetParams <span class="token operator">&amp;</span> element
            <span class="token keyword">Else</span>
                GetParams <span class="token operator">=</span> GetParams <span class="token operator">&amp;</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">&amp;</span> element
        <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token keyword">Next</span>

    
    <span class="token keyword">Static</span> id <span class="token keyword">As</span> <span class="token keyword">Long</span>
    id <span class="token operator">=</span> id <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">If</span> id <span class="token operator">&gt;</span><span class="token operator">=</span> <span class="token number">60000</span> <span class="token keyword">Then</span>
        id <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    
    URL <span class="token operator">=</span> URL <span class="token operator">&amp;</span> GetParams <span class="token operator">&amp;</span> <span class="token string">&quot;&amp;i=&quot;</span> <span class="token operator">&amp;</span> id
    
    <span class="token keyword">Dim</span> http
    <span class="token keyword">Set</span> http <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;Microsoft.XMLHTTP&quot;</span><span class="token punctuation">)</span>

    http<span class="token punctuation">.</span>Open <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> URL<span class="token punctuation">,</span> <span class="token boolean">False</span>
    http<span class="token punctuation">.</span>send

    <span class="token keyword">If</span> http<span class="token punctuation">.</span>Status <span class="token operator">=</span> <span class="token number">200</span> <span class="token keyword">Then</span>
        tt <span class="token operator">=</span> http<span class="token punctuation">.</span>responseText
        ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j13&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> tt
    <span class="token keyword">Else</span>
        CtronlReFresh <span class="token operator">=</span> <span class="token number">1</span>
        MsgBox <span class="token string">&quot;ÇëÇó³¬Ê±£¬ÐÐÇéÒÑÍ£Ö¹½ÓÊÕ&quot;</span>
        ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j13&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;httpÇëÇóÊ§°Ü&quot;</span>
        <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
    <span class="token keyword">End</span> <span class="token keyword">If</span>
    <span class="token comment">'Do</span>
<span class="token comment">'        With CreateObject(&quot;Microsoft.XMLHTTP&quot;)</span>
<span class="token comment">'            .Open &quot;GET&quot;, URL, False</span>
<span class="token comment">'            .send</span>
<span class="token comment">'            tt = .responseText</span>
<span class="token comment">'            With CreateObject(&quot;new:{1C3B4210-F441-11CE-B9EA-00AA006B1A69}&quot;)</span>
<span class="token comment">'                .SetText tt</span>
<span class="token comment">'                .PutInClipboard</span>
<span class="token comment">'            End With</span>
<span class="token comment">'            tt = BytesToBstr(.ResponseBody, &quot;GB2312&quot;)</span>
<span class="token comment">'        End With</span>
    <span class="token comment">'Do</span>

        <span class="token keyword">Dim</span> objRegEx <span class="token keyword">As</span> <span class="token keyword">Object</span>
        <span class="token keyword">Set</span> objRegEx1 <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;vbscript.regexp&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">Set</span> objRegEx2 <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;vbscript.regexp&quot;</span><span class="token punctuation">)</span>
    
    
        <span class="token keyword">For</span> <span class="token keyword">Each</span> element <span class="token keyword">In</span> InstrumentIdMap<span class="token punctuation">.</span>Keys
            objRegEx1<span class="token punctuation">.</span>Pattern <span class="token operator">=</span> <span class="token string">&quot;&quot;&quot;&quot;</span> <span class="token operator">&amp;</span> element <span class="token operator">&amp;</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">&amp;</span> LastPrice <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;&quot;&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;:(.*?)[, }]&quot;</span>
            objRegEx2<span class="token punctuation">.</span>Pattern <span class="token operator">=</span> <span class="token string">&quot;&quot;&quot;&quot;</span> <span class="token operator">&amp;</span> element <span class="token operator">&amp;</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">&amp;</span> PreSettlementPrice <span class="token operator">&amp;</span> <span class="token string">&quot;&quot;&quot;&quot;</span> <span class="token operator">&amp;</span> <span class="token string">&quot;:(.*?)[, }]&quot;</span>
            <span class="token keyword">Set</span> objMH1 <span class="token operator">=</span> objRegEx1<span class="token punctuation">.</span>Execute<span class="token punctuation">(</span>tt<span class="token punctuation">)</span>
            <span class="token keyword">Set</span> objMH2 <span class="token operator">=</span> objRegEx2<span class="token punctuation">.</span>Execute<span class="token punctuation">(</span>tt<span class="token punctuation">)</span>
            <span class="token keyword">If</span> objMH1<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">Then</span>
                Debug<span class="token punctuation">.</span>Print objMH1<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>submatches<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                InstrumentInfoMap<span class="token punctuation">(</span>element <span class="token operator">&amp;</span> LastPrice<span class="token punctuation">)</span> <span class="token operator">=</span> Val<span class="token punctuation">(</span>objMH1<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>submatches<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">If</span> objMH2<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">Then</span>
                Debug<span class="token punctuation">.</span>Print objMH2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>submatches<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                InstrumentInfoMap<span class="token punctuation">(</span>element <span class="token operator">&amp;</span> PreSettlementPrice<span class="token punctuation">)</span> <span class="token operator">=</span> Val<span class="token punctuation">(</span>objMH2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>submatches<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">End</span> <span class="token keyword">If</span>
        <span class="token keyword">Next</span> element
        
    
        
        <span class="token keyword">Dim</span> Inst
        <span class="token keyword">With</span> ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">To</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> InstrumentIdNum<span class="token punctuation">)</span>
                <span class="token keyword">If</span> <span class="token keyword">Not</span> IsEmpty<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                    Inst <span class="token operator">=</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value

                    <span class="token comment">'Debug.Print Inst, .Range(&quot;d&quot; &amp; i)</span>
                    <span class="token keyword">If</span> <span class="token keyword">Not</span> IsEmpty<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">And</span> <span class="token keyword">Not</span> IsEmpty<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                        <span class="token keyword">If</span> <span class="token keyword">Not</span> InstrumentInfoMap<span class="token punctuation">(</span>Inst <span class="token operator">&amp;</span> LastPrice<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span>
                            ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;ºÏÔ¼:&quot;</span> <span class="token operator">&amp;</span> Inst <span class="token operator">&amp;</span> <span class="token string">&quot;ÊµÊ±ÐÐÇé»ñÈ¡³É¹¦&quot;</span>
                            ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token operator">=</span> InstrumentInfoMap<span class="token punctuation">(</span>Inst <span class="token operator">&amp;</span> LastPrice<span class="token punctuation">)</span>
                        <span class="token keyword">Else</span>
                            ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;ºÏÔ¼:&quot;</span> <span class="token operator">&amp;</span> Inst <span class="token operator">&amp;</span> <span class="token string">&quot;ÊµÊ±ÐÐÇé»ñÈ¡Ê§°Ü&quot;</span>
                        <span class="token keyword">End</span> <span class="token keyword">If</span>
                        
                    <span class="token keyword">End</span> <span class="token keyword">If</span>
                    <span class="token keyword">If</span> <span class="token keyword">Not</span> IsEmpty<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">And</span> <span class="token keyword">Not</span> IsEmpty<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
                        <span class="token keyword">If</span> <span class="token keyword">Not</span> InstrumentInfoMap<span class="token punctuation">(</span>Inst <span class="token operator">&amp;</span> PreSettlementPrice<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span>
                            ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;ºÏÔ¼:&quot;</span> <span class="token operator">&amp;</span> Inst <span class="token operator">&amp;</span> <span class="token string">&quot;Ç°ÈÕ½áËã¼Û»ñÈ¡³É¹¦&quot;</span>
                            ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token operator">=</span> InstrumentInfoMap<span class="token punctuation">(</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> PreSettlementPrice<span class="token punctuation">)</span>
                        <span class="token keyword">Else</span>
                            ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span> <span class="token operator">&amp;</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;ºÏÔ¼:&quot;</span> <span class="token operator">&amp;</span> Inst <span class="token operator">&amp;</span> <span class="token string">&quot;Ç°ÈÕ½áËã¼Û»ñÈ¡Ê§°Ü&quot;</span>
                        <span class="token keyword">End</span> <span class="token keyword">If</span>
                    <span class="token keyword">End</span> <span class="token keyword">If</span>
                    ThisWorkbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token string">&quot;ÅäÖÃ²ÎÊý&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;j10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;ÉÏ´ÎË¢ÐÂÊ±¼ä:&quot;</span> <span class="token operator">&amp;</span> Time
                
                <span class="token keyword">End</span> <span class="token keyword">If</span>
            <span class="token keyword">Next</span>
        <span class="token keyword">End</span> <span class="token keyword">With</span>
        
        <span class="token comment">'Application.Wait Now + TimeValue(&quot;0:00:10&quot;)</span>
    <span class="token comment">'Loop</span>
    
    <span class="token keyword">Set</span> InstrumentIdMap <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Set</span> InstrumentInfoMap <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Set</span> objRegEx2 <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Set</span> objRegEx1 <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token keyword">Set</span> http <span class="token operator">=</span> <span class="token boolean">Nothing</span>
    <span class="token comment">'Debug.Print CtronlReFresh</span>
    CtronlReFresh <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">Sub</span> stop_refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    CtronlReFresh <span class="token operator">=</span> <span class="token number">1</span>
    MsgBox <span class="token string">&quot;ÐÐÇéÒÑÍ£Ö¹½ÓÊÕ&quot;</span>
        <span class="token comment">'On Error Resume Next</span>
        <span class="token comment">'Application.OnTime t + TimeValue(&quot;00:00:05&quot;), &quot;refresh&quot;, False</span>
        <span class="token comment">'Application.OnTime t, &quot;refresh&quot;, , False 'Í£Ö¹³ÌÐòÔËÐÐ</span>

<span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">Sub</span> start_refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
    CtronlReFresh <span class="token operator">=</span> <span class="token number">0</span>
    MsgBox <span class="token string">&quot;ÐÐÇéÕý¿ªÊ¼½ÓÊÕ&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2020年4月19日星期日下午12点32分</span></div></footer> <!---->  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c66daf63.js" defer></script><script src="/assets/js/6.a4c4b5d6.js" defer></script><script src="/assets/js/2.1492d491.js" defer></script><script src="/assets/js/19.4c204b03.js" defer></script><script src="/assets/js/3.90399333.js" defer></script>
  </body>
</html>
